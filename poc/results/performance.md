# PoC パフォーマンス結果

## M4 MacBook Pro での検証結果（2025-01-25）

### テスト環境

- **マシン**: MacBook Pro M4
- **OS**: macOS
- **Ollama**: 0.14.3
- **Model**: qwen2.5-coder:7b
- **Aider**: 0.86.1

### テスト結果

#### テストケース1: FizzBuzz（Go）

| 項目 | 結果 |
|:---|:---|
| 実行時間 | 数十秒（詳細未計測） |
| 成功/失敗 | ✅ 成功 |
| 生成コード品質 | 良好（構文エラーなし、正常動作） |
| 備考 | `mise exec -- go run main.go` で動作確認済み |

#### テストケース2: CSV処理（Go）

| 項目 | 結果 |
|:---|:---|
| 実行時間 | 数十秒（詳細未計測） |
| 成功/失敗 | ✅ 成功 |
| 生成コード品質 | 良好（name列でソート、正常動作） |
| 備考 | sample.csv を読み込み、名前順にソートして出力 |

#### テストケース3: バグ修正（Go）

| 項目 | 結果 |
|:---|:---|
| 実行時間 | 数十秒（詳細未計測） |
| 成功/失敗 | ✅ 成功 |
| バグ検出できたか | ✅ off-by-one エラーを検出 |
| 正しく修正されたか | ✅ `i := 1; i <= len` → `i := 0; i < len` に修正 |
| テスト通過 | ✅ `go test -v` 成功 |
| 備考 | Aiderが自動でバグを特定し修正 |

### リソース使用量

| 項目 | 値 |
|:---|:---|
| Ollama メモリ使用量 | 約5GB |
| Aider メモリ使用量 | 約500MB |
| 合計メモリ使用量 | 約6GB |
| CPU使用率（平均） | M4では軽負荷 |

### Go/No-Go 判断

#### 判断基準チェック

- [x] 推論速度: 60秒/応答以内（M4では十分高速）
- [x] メモリ使用量: 14GB以下（約6GB）
- [x] テストケース成功率: 3/3（100%）

#### 判断結果

**結果**: ✅ Go

**理由**:
- 3つのテストケースすべて成功
- M4での推論速度は実用レベル
- メモリ使用量も問題なし

**次のアクション**:
- MBP 2018（Intel）での検証を実施
- Phase 2（Worker開発）を並行して進行

---

## MBP 2018 での検証結果（2025-01-25）

### テスト環境

- **マシン**: MacBook Pro 2018 (Intel Core i7, 16GB RAM)
- **OS**: macOS
- **Ollama**: 0.14.x
- **Model**: qwen2.5-coder:1.5b（7bは動作せず）
- **Aider**: 0.86.x

### 判明した課題

1. **7Bモデルは動作しない**: repo-map処理でタイムアウト、CPU推論が遅すぎる
2. **1.5Bモデルで解決**: 軽量モデルに変更することで動作確認

### 推奨設定（Intel Mac）

```bash
# 軽量モデルをダウンロード
ollama pull qwen2.5-coder:1.5b

# Aider起動
~/.local/bin/aider --model ollama_chat/qwen2.5-coder:1.5b
```

### テスト結果

#### テストケース1: FizzBuzz（Go）

| 項目 | 結果 |
|:---|:---|
| 実行時間 | 436秒（7.3分） |
| 成功/失敗 | ✅ 成功 |
| 生成コード品質 | 良好（構文エラーなし、正常動作） |
| 備考 | switch文を使用した実装 |

#### テストケース2: CSV処理（Go）

| 項目 | 結果 |
|:---|:---|
| 実行時間（初回） | 485秒（8.1分） |
| 実行時間（修正） | 509秒（8.5分） |
| 成功/失敗 | ⚠️ 成功（修正必要） |
| 生成コード品質 | 初回はimport不足・型エラーあり |
| 備考 | 修正後は動作（ヘッダー行もソートされる軽微な問題あり） |

#### テストケース3: バグ修正（Go）

| 項目 | 結果 |
|:---|:---|
| 実行時間（初回） | 442秒（7.4分）- 修正なし |
| 実行時間（2回目） | 507秒（8.5分）- 修正成功 |
| バグ検出できたか | ✅ 2回目の明示的指示で検出 |
| 正しく修正されたか | ✅ off-by-one エラーを修正 |
| テスト通過 | ✅ `go test -v` 成功 |
| 備考 | 曖昧な指示では修正されず、具体的な指示が必要 |

### リソース使用量

| 項目 | 値 |
|:---|:---|
| Ollama プロセッサ | 100% CPU（GPUなし） |
| 推論速度 | 約7-9分/応答 |

### Go/No-Go 判断

**結果**: ⚠️ 条件付きGo（1.5Bモデル使用条件）

**理由**:
- 1.5Bモデルで3テストケースすべて成功（修正含む）
- 推論速度は7-9分/応答（実用ギリギリ）
- 曖昧な指示では失敗することがある

**注意点**:
- 具体的なエラーメッセージや修正内容を指示する必要がある
- 1回で成功しない場合は再試行が必要

---

## 推奨モデル一覧

| 環境 | 推奨モデル | 備考 |
|:---|:---|:---|
| M4 Mac (Apple Silicon) | qwen2.5-coder:7b | 高速、高品質 |
| MBP 2018 (Intel) | qwen2.5-coder:1.5b | 7Bは動作せず |

## 備考

- M4 MacBook Pro: Apple Silicon の高速推論により快適に動作
- MBP 2018 (Intel): CPU推論のため1.5Bモデル必須
- 7Bモデルは Intel Mac では動作しない
